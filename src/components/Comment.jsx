//? satisfaction
// 0 : نظری ندارم
// 1 : پیشنهاد میکنم
// 2 : پیشنهاد نمیکنم

import { Box, Typography, Divider, Avatar } from "@mui/material";
import { createComment } from "@/services/ProductPage";
import { useAuth } from "@/context/AuthContext";
import SendComment from "./product/SendComment";
import { enqueueSnackbar } from "notistack";

const Comment = ({ pid, comments }) => {
	const { tokens } = useAuth();

	const handleSendComment = async (values) => {
		try {
			await createComment({
				pid,
				access: tokens.access,
				data: {
					text: values.text,
					anonymous: values.anonymous,
					rate: values.rate,
					satisfaction: values.seleted,
				},
			});
			enqueueSnackbar({
				message: "کامنت شما بعد از تایید ادمین نمایش داده خواهد شد.",
				variant: "success",
			});
		} catch (error) {
			enqueueSnackbar({
				message: "لطفا ابتدا لاگین کنید.",
				variant: "warning",
			});
		}
	};
	return (
		<Box
			maxWidth="lg"
			sx={{
				mt: 4,
				mb: 4,
				mx: "auto",
			}}>
			{comments.map((comment) => {
				return (
					<>
						<Box
							key={comment.id}
							sx={{
								display: "flex",
								alignItems: { xs: "start", md: "center" },
								justifyContent: { xs: "center", md: "start" },
								flexDirection: { xs: "column", md: "row" },
							}}>
							<Box
								display="flex"
								justifyContent="space-between"
								alignItems="center">
								<Avatar
									src={comment.image}
									sx={{ width: 30, height: 30, mr: 2 }}
								/>
								<Typography
									maxWidth={250}
									noWrap
									variant="h6"
									mr={5}>
									{comment.anonymous ? "کاربر" : comment.user_full_name}
								</Typography>
								<Typography
									pr={4}
									noWrap
									variant="caption"
									color="#747678">
									{comment.days_since_creation}
								</Typography>
							</Box>
							<Box
								sx={{
									mt: { xs: 2, md: 0 },
									ml: { xs: 2, md: 0 },
								}}>
								{comment.satisfaction === 1 ? (
									<Box sx={{ display: "flex" }}>
										<svg
											width="18"
											height="18"
											viewBox="0 0 20 20"
											fill="none"
											xmlns="http://www.w3.org/2000/svg">
											<path
												d="M2.5 8.52818L3.1225 8.47485C3.10815 8.31478 3.0327 8.16639 2.9118 8.06049C2.79091 7.9546 2.63387 7.89935 2.4733 7.90621C2.31273 7.91308 2.16098 7.98153 2.04957 8.09736C1.93815 8.21318 1.87563 8.36747 1.875 8.52818H2.5ZM16.8633 10.0474L16.275 13.4473L17.5075 13.6607L18.095 10.2607L16.8633 10.0474ZM11.0375 17.7082H7.16333V18.9582H11.0375V17.7082ZM6.40417 17.0107L5.7275 9.18318L4.48167 9.29068L5.15917 17.1182L6.40417 17.0107ZM16.275 13.4473C15.8525 15.889 13.6508 17.7082 11.0375 17.7082V18.9582C14.2258 18.9582 16.9758 16.734 17.5075 13.6607L16.275 13.4473ZM11.0458 4.24985L10.4933 7.62068L11.7267 7.82235L12.2792 4.45235L11.0458 4.24985ZM5.99 8.53818L7.18917 7.50485L6.3725 6.55818L5.175 7.59152L5.99 8.53818ZM9.37 4.14318L9.76667 2.61485L8.55667 2.30152L8.16 3.82902L9.37 4.14318ZM10.365 2.31485L10.4858 2.35402L10.8683 1.16402L10.7475 1.12485L10.365 2.31485ZM8.76917 5.67985C9.02948 5.19318 9.23116 4.67735 9.37 4.14318L8.16 3.82902C8.04607 4.26788 7.88047 4.69168 7.66667 5.09152L8.76917 5.67985ZM10.4858 2.35402C10.6047 2.39005 10.7126 2.45554 10.7994 2.54441C10.8863 2.63328 10.9492 2.74264 10.9825 2.86235L12.1925 2.54902C12.1064 2.22527 11.9398 1.92854 11.7083 1.6864C11.4768 1.44426 11.1879 1.26457 10.8683 1.16402L10.4858 2.35402ZM9.76667 2.61485C9.78328 2.55483 9.81275 2.49914 9.85304 2.45165C9.89334 2.40416 9.94348 2.36601 10 2.33985L9.4575 1.21402C9.01417 1.42735 8.68083 1.82235 8.55667 2.30152L9.76667 2.61485ZM10 2.33985C10.1141 2.28538 10.2446 2.27644 10.365 2.31485L10.7475 1.12485C10.3219 0.98845 9.86026 1.02036 9.4575 1.21402L10 2.33985ZM11.795 9.15318H16.1117V7.90318H11.795V9.15318ZM3.9325 17.8382L3.1225 8.47485L1.8775 8.58235L2.68583 17.9457L3.9325 17.8382ZM3.125 17.9273V8.52818H1.875V17.9273H3.125ZM2.68583 17.9457C2.68329 17.9154 2.68791 17.8849 2.69778 17.8562C2.70765 17.8274 2.72339 17.8011 2.744 17.7787C2.76461 17.7564 2.78964 17.7386 2.8175 17.7264C2.84536 17.7143 2.87544 17.7081 2.90583 17.7082V18.9582C3.51083 18.9582 3.98417 18.4398 3.9325 17.8382L2.68583 17.9457ZM12.2792 4.45235C12.3831 3.81879 12.3536 3.17051 12.1925 2.54902L10.9825 2.86318C11.0999 3.31595 11.1215 3.78826 11.0458 4.24985L12.2792 4.45235ZM7.16333 17.7082C6.97251 17.7079 6.78873 17.6361 6.64821 17.507C6.50769 17.3779 6.42062 17.2008 6.40417 17.0107L5.15917 17.1182C5.20253 17.62 5.4324 18.0873 5.80342 18.4279C6.17444 18.7686 6.65966 18.9578 7.16333 18.9582V17.7082ZM7.18917 7.50485C7.75583 7.01652 8.36583 6.43568 8.77 5.67985L7.66667 5.09152C7.37833 5.63235 6.91917 6.08818 6.3725 6.55818L7.18917 7.50485ZM18.095 10.2607C18.1452 9.97151 18.1315 9.67486 18.055 9.39151C17.9784 9.10817 17.8409 8.84499 17.6519 8.6204C17.463 8.39581 17.2272 8.21524 16.9612 8.09135C16.6951 7.96746 16.4052 7.90324 16.1117 7.90318V9.15318C16.5842 9.15318 16.945 9.57985 16.8633 10.0474L18.095 10.2607ZM2.90583 17.7082C3.0275 17.7082 3.125 17.8065 3.125 17.9273H1.875C1.875 18.4957 2.33583 18.9582 2.90583 18.9582V17.7082ZM10.4933 7.62068C10.4623 7.8095 10.4726 8.00281 10.5238 8.18722C10.5749 8.37162 10.6655 8.54269 10.7893 8.68857C10.9132 8.83445 11.0673 8.95164 11.2409 9.03201C11.4146 9.11239 11.6036 9.15318 11.795 9.15318V7.90318C11.7848 7.90323 11.7748 7.90187 11.7656 7.89758C11.7563 7.8933 11.7482 7.88704 11.7416 7.87924C11.7351 7.87144 11.7304 7.8623 11.7278 7.85247C11.7252 7.84263 11.7248 7.83235 11.7267 7.82235L10.4933 7.62068ZM5.7275 9.18318C5.7172 9.0625 5.73487 8.9411 5.78065 8.82897C5.82643 8.71683 5.89818 8.61717 5.99 8.53818L5.17333 7.59068C4.93168 7.79904 4.74296 8.06181 4.62271 8.35736C4.50247 8.65292 4.45412 8.9728 4.48167 9.29068L5.7275 9.18318Z"
												fill="#4ECB71"
											/>
										</svg>
										<Typography
											noWrap
											color="#747678"
											mt={0.3}
											mx={1}
											fontSize={12}>
											{"خرید این محصول را پیشنهاد می کنم."}
										</Typography>
									</Box>
								) : (
									comment.satisfaction === -1 && (
										<Box
											sx={{ display: "flex" }}
											alignItems="center">
											<svg
												width="18"
												height="18"
												viewBox="0 0 18 18"
												fill="none"
												xmlns="http://www.w3.org/2000/svg">
												<path
													d="M1.5 10.4718L2.1225 10.5251C2.10815 10.6852 2.0327 10.8336 1.9118 10.9395C1.79091 11.0454 1.63387 11.1007 1.4733 11.0938C1.31273 11.0869 1.16098 11.0185 1.04957 10.9026C0.938149 10.7868 0.875632 10.6325 0.875 10.4718H1.5ZM15.8633 8.95265L15.275 5.55265L16.5075 5.33932L17.095 8.73932L15.8633 8.95265ZM10.0375 1.29182H6.16333V0.0418167H10.0375V1.29182ZM5.40417 1.98932L4.7275 9.81682L3.48167 9.70932L4.15917 1.88182L5.40417 1.98932ZM15.275 5.55265C14.8525 3.11098 12.6508 1.29182 10.0375 1.29182V0.0418167C13.2258 0.0418167 15.9758 2.26598 16.5075 5.33932L15.275 5.55265ZM10.0458 14.7501L9.49333 11.3793L10.7267 11.1776L11.2792 14.5476L10.0458 14.7501ZM4.99 10.4618L6.18917 11.4952L5.3725 12.4418L4.175 11.4085L4.99 10.4618ZM8.37 14.8568L8.76667 16.3851L7.55667 16.6985L7.16 15.171L8.37 14.8568ZM9.365 16.6851L9.48583 16.646L9.86833 17.836L9.7475 17.8751L9.365 16.6851ZM7.76917 13.3201C8.02948 13.8068 8.23116 14.3226 8.37 14.8568L7.16 15.171C7.04607 14.7321 6.88047 14.3083 6.66667 13.9085L7.76917 13.3201ZM9.48583 16.646C9.60474 16.6099 9.71261 16.5445 9.79944 16.4556C9.88626 16.3667 9.94923 16.2574 9.9825 16.1376L11.1925 16.451C11.1064 16.7747 10.9398 17.0715 10.7083 17.3136C10.4768 17.5557 10.1879 17.7354 9.86833 17.836L9.48583 16.646ZM8.76667 16.3851C8.78328 16.4452 8.81275 16.5009 8.85304 16.5483C8.89334 16.5958 8.94348 16.634 9 16.6601L8.4575 17.786C8.01417 17.5726 7.68083 17.1776 7.55667 16.6985L8.76667 16.3851ZM9 16.6601C9.11405 16.7146 9.24458 16.7236 9.365 16.6851L9.7475 17.8751C9.32193 18.0115 8.86026 17.9796 8.4575 17.786L9 16.6601ZM10.795 9.84682H15.1117L15.1117 11.0968L10.795 11.0968L10.795 9.84682ZM2.9325 1.16182L2.1225 10.5251L0.8775 10.4176L1.68583 1.05432L2.9325 1.16182ZM2.125 1.07265L2.125 10.4718H0.875L0.875 1.07265H2.125ZM1.68583 1.05432C1.68329 1.0846 1.68791 1.11509 1.69778 1.14383C1.70765 1.17257 1.72339 1.19895 1.744 1.22128C1.76461 1.24362 1.78964 1.26142 1.8175 1.27357C1.84536 1.28571 1.87544 1.29192 1.90583 1.29182L1.90583 0.0418167C2.51083 0.0418167 2.98417 0.56015 2.9325 1.16182L1.68583 1.05432ZM11.2792 14.5476C11.3831 15.1812 11.3536 15.8295 11.1925 16.451L9.9825 16.1368C10.0999 15.684 10.1215 15.2117 10.0458 14.7501L11.2792 14.5476ZM6.16333 1.29182C5.97251 1.29215 5.78873 1.36394 5.64821 1.49304C5.50769 1.62215 5.42062 1.7992 5.40417 1.98932L4.15917 1.88182C4.20253 1.38002 4.4324 0.912693 4.80342 0.572063C5.17444 0.231434 5.65966 0.0422401 6.16333 0.0418167V1.29182ZM6.18917 11.4952C6.75583 11.9835 7.36583 12.5643 7.77 13.3201L6.66667 13.9085C6.37833 13.3676 5.91917 12.9118 5.3725 12.4418L6.18917 11.4952ZM17.095 8.73932C17.1452 9.02849 17.1315 9.32514 17.055 9.60849C16.9784 9.89183 16.8409 10.155 16.6519 10.3796C16.463 10.6042 16.2272 10.7848 15.9612 10.9087C15.6951 11.0325 15.4052 11.0968 15.1117 11.0968L15.1117 9.84682C15.5842 9.84682 15.945 9.42015 15.8633 8.95265L17.095 8.73932ZM1.90583 1.29182C2.0275 1.29182 2.125 1.19348 2.125 1.07265H0.875C0.875 0.504316 1.33583 0.0418167 1.90583 0.0418167L1.90583 1.29182ZM9.49333 11.3793C9.46227 11.1905 9.47265 10.9972 9.52376 10.8128C9.57488 10.6284 9.6655 10.4573 9.78933 10.3114C9.91317 10.1655 10.0673 10.0484 10.2409 9.96799C10.4146 9.88761 10.6036 9.84682 10.795 9.84682L10.795 11.0968C10.7848 11.0968 10.7748 11.0981 10.7656 11.1024C10.7563 11.1067 10.7482 11.113 10.7416 11.1208C10.7351 11.1286 10.7304 11.1377 10.7278 11.1475C10.7252 11.1574 10.7248 11.1676 10.7267 11.1776L9.49333 11.3793ZM4.7275 9.81682C4.7172 9.9375 4.73487 10.0589 4.78065 10.171C4.82643 10.2832 4.89818 10.3828 4.99 10.4618L4.17333 11.4093C3.93168 11.201 3.74296 10.9382 3.62271 10.6426C3.50247 10.3471 3.45412 10.0272 3.48167 9.70932L4.7275 9.81682Z"
													fill="#BB0000"
												/>
											</svg>
											<Typography
												noWrap
												color="#747678"
												mx={1}
												fontSize={12}>
												{"خرید این محصول را پیشنهاد نمی کنم."}
											</Typography>
										</Box>
									)
								)}
							</Box>
						</Box>
						<Box sx={{ mt: 3, ml: 6 }}>
							<Typography color="#747678">{comment.text}</Typography>
						</Box>
						<Divider
							sx={{
								border: "0.01em solid",
								maxWidth: "lg",
								my: 2,
								mx: "auto",
							}}
							variant="middle"
						/>
					</>
				);
			})}
			<SendComment handleSendComment={handleSendComment} />
		</Box>
	);
};

export default Comment;
